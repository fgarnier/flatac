#include ../Makefile.conf
#

#FLATAC_ROOT := flatac 
TYPES_INCLUDES := ${FRAMA_C_INCLUDES} 
GENSOURCE := ntl_parser.ml ntl_parser.mli ntl_lexer.ml 
SOURCE_FILES := nts_types.ml nts.ml nts_functor.ml ntsint.ml nts_generic.ml\
	     parsing_error.ml

CFLAGS = -g -annot -c
INTERFACES = ntl_parser.mli
OBJECTS = nts_types.cmo nts.cmo nts_generic.cmo nts_functor.cmo ntsint.cmo \
	ntl_lexer.cmo parsing_error.cmo \
	ntl_parser.cmo parse_n_print.cmo 

LIBNUM = nums.cma # Contains Big_int module   
INTERFACES = $(OBJECTS:.cmo=.cmi)
TEST = parse_n_print
 
clean : 
	rm -f *.cmo *.cmi *.cma *.annot parse_n_print $(GENSOURCE)

all : .depend $(INTERFACES) $(OBJECTS) $(TEST)
	ocamlc -o ocaml_ntl.cma -a $(OBJECTS)

%.cmo : %.ml
	@echo  "Compiling"  $<
	@ocamlc ${CFLAGS}  $< -o $@ ${TYPES_INCLUDES}

%.cmi : %.mli
	@echo  "Compiling interface " $<
	@ocamlc ${CFLAGS}  $< -o $@ $(TYPES_INCLUDES)

ntl_lexer.cmi : ntl_parser.mli

ntl_parser.mli : ntl_parser.ml


ntl_parser.ml : ntl_parser.mly
	@echo  "Generating Parser" $<
	@ocamlyacc $<

ntl_lexer.ml : ntl_lexer.mll
	@echo  "Generating Lexer" $<
	@ocamllex $<

parse_n_print : parse_n_print.ml $(OBJECTS)
	@echo "Compiling parse_n_print test"
	ocamlc -g -o parse_n_print $(LIBNUM) $(OBJECTS)

include .depend

.depend: $(GENSOURCE)  
	ocamldep *.ml *.mli > .depend




